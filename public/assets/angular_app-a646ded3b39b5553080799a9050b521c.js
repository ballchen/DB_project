"format global";"deps angular";"deps moment";!function(){"use strict";function e(e,n){return e.module("angularMoment",[]).constant("angularMomentConfig",{preprocess:null,timezone:"",format:null,statefulFilters:!0}).constant("moment",n).constant("amTimeAgoConfig",{withoutSuffix:!1,serverTime:null,titleFormat:null}).directive("amTimeAgo",["$window","moment","amMoment","amTimeAgoConfig","angularMomentConfig",function(n,t,o,r,a){return function(i,u,l){function c(){var e;if(r.serverTime){var n=(new Date).getTime(),o=n-w+r.serverTime;e=t(o)}else e=t();return e}function s(){h&&(n.clearTimeout(h),h=null)}function m(e){if(u.text(e.from(c(),y)),_&&!u.attr("title")&&u.attr("title",e.local().format(_)),!T){var t=Math.abs(c().diff(e,"minute")),o=3600;1>t?o=1:60>t?o=30:180>t&&(o=300),h=n.setTimeout(function(){m(e)},1e3*o)}}function f(e){F&&u.attr("datetime",e)}function d(){if(s(),p){var e=o.preprocessDate(p,$,v);m(e),f(e.toISOString())}}var p,g,h=null,v=a.format,y=r.withoutSuffix,_=r.titleFormat,w=(new Date).getTime(),$=a.preprocess,M=l.amTimeAgo.replace(/^::/,""),T=0===l.amTimeAgo.indexOf("::"),F="TIME"===u[0].nodeName.toUpperCase();g=i.$watch(M,function(e){return"undefined"==typeof e||null===e||""===e?(s(),void(p&&(u.text(""),f(""),p=null))):(p=e,d(),void(void 0!==e&&T&&g()))}),e.isDefined(l.amWithoutSuffix)&&i.$watch(l.amWithoutSuffix,function(e){"boolean"==typeof e?(y=e,d()):y=r.withoutSuffix}),l.$observe("amFormat",function(e){"undefined"!=typeof e&&(v=e,d())}),l.$observe("amPreprocess",function(e){$=e,d()}),i.$on("$destroy",function(){s()}),i.$on("amMoment:localeChanged",function(){d()})}}]).service("amMoment",["moment","$rootScope","$log","angularMomentConfig",function(n,t,o,r){var a=this;this.preprocessors={utc:n.utc,unix:n.unix},this.changeLocale=function(o){var r=(n.locale||n.lang)(o);return e.isDefined(o)&&(t.$broadcast("amMoment:localeChanged"),t.$broadcast("amMoment:languageChange")),r},this.changeLanguage=function(e){return o.warn("angular-moment: Usage of amMoment.changeLanguage() is deprecated. Please use changeLocale()"),a.changeLocale(e)},this.preprocessDate=function(t,a,i){return e.isUndefined(a)&&(a=r.preprocess),this.preprocessors[a]?this.preprocessors[a](t,i):(a&&o.warn("angular-moment: Ignoring unsupported value for preprocess: "+a),!isNaN(parseFloat(t))&&isFinite(t)?n(parseInt(t,10)):n(t,i))},this.applyTimezone=function(e){var n=r.timezone;return e&&n&&(e.tz?e=e.tz(n):o.warn("angular-moment: timezone specified but moment.tz() is undefined. Did you forget to include moment-timezone.js?")),e}}]).filter("amCalendar",["moment","amMoment","angularMomentConfig",function(e,n,t){function o(t,o){if("undefined"==typeof t||null===t)return"";t=n.preprocessDate(t,o);var r=e(t);return r.isValid()?n.applyTimezone(r).calendar():""}return o.$stateful=t.statefulFilters,o}]).filter("amDateFormat",["moment","amMoment","angularMomentConfig",function(e,n,t){function o(t,o,r){if("undefined"==typeof t||null===t)return"";t=n.preprocessDate(t,r);var a=e(t);return a.isValid()?n.applyTimezone(a).format(o):""}return o.$stateful=t.statefulFilters,o}]).filter("amDurationFormat",["moment","angularMomentConfig",function(e,n){function t(n,t,o){return"undefined"==typeof n||null===n?"":e.duration(n,t).humanize(o)}return t.$stateful=n.statefulFilters,t}]).filter("amTimeAgo",["moment","amMoment","angularMomentConfig",function(e,n,t){function o(t,o,r){if("undefined"==typeof t||null===t)return"";t=n.preprocessDate(t,o);var a=e(t);return a.isValid()?n.applyTimezone(a).fromNow(r):""}return o.$stateful=t.statefulFilters,o}])}"function"==typeof define&&define.amd?define("angular-moment",["angular","moment"],e):"undefined"!=typeof module&&module&&module.exports?e(angular,require("moment")):e(angular,window.moment)}(),angular.module("app",["ui.bootstrap","ui.select2","angular-underscore","highcharts-ng","angularMoment","map","chart","event","app.controller"]).run(function(e){e.changeLocale("zh-tw")}).constant("angularMomentConfig",{preprocess:"unix",timezone:"Asia/Taipei"}),angular.module("chart",["chart.controller"]),angular.module("chart.controller",[]).controller("chart",["$scope","$http","$window",function(e,n){console.log("chart"),n.get("/api/get_current_user").success(function(t){e.current_user_id=t,n({method:"GET",url:"/api/likes/"+e.current_user_id}).success(function(e){var n,t,o=[],r=["#637b85","#2c9c69","#dbba34","#c62f29","#F38630","#E0E4CC","#69D2E7","#003399","#3366AA","#FFD700","#FF4500","#FFFF00"];_.each(e,function(e){n=_.findWhere(o,{label:e.category}),void 0!==n?(t=_.indexOf(o,n),o[t].value=o[t].value+1):o.push({label:e.category,value:1,color:r[o.length%r.length]})});var a=document.getElementById("chart-area").getContext("2d");window.myDoughnut=new Chart(a).Doughnut(o,{responsive:!0})})})}]),angular.module("app.controller",[]).controller("index",["$scope",function(){console.log("index")}]),angular.module("event",["event.controller"]),angular.module("event.controller",[]).controller("event",["$scope","$http","$window",function(e,n){console.log("event"),n.get("/api/get_current_user").success(function(t){e.current_user_id=t,n.get("/api/events/"+e.current_user_id).success(function(n){e.years=[];var t,o;_.each(n,function(n){null!==n.start_time&&(o=moment(n.start_time).format("YYYY"),t=_.findWhere(e.years,{year:o}),void 0!==t?(index=_.indexOf(e.years,t),e.years[index].events.push(n)):e.years.push({year:o,events:[n]}))}),e.years=_.sortBy(e.years,function(e){return-e.year})})})}]),angular.module("map",["map.controller"]),angular.module("map.controller",[]).controller("map",["$scope","$http","$window",function(e,n){console.log("map");var t,o=Gmaps.build("Google",{markers:{clusterer:void 0}});n.get("/api/get_current_user").success(function(r){e.current_user_id=r,n({method:"GET",url:"/api/places/"+e.current_user_id}).success(function(n){e.places=n;var r,a=_.map(e.places,function(e){r=e.location;var n=null!==r.street?r.street:"",t=null!==r.city?r.city:"",o=null!==r.country?r.country:"",a=n+" "+t+" "+o?n+" "+t+" "+o:"",i="<h3>"+e.name+"</h3><p>"+a+"</p>";return _.each(e.tagged_user,function(e){i=i+'<img width="200" src="'+e.user.pic+'"><h4>'+e.user.name+"</h4>"}),{infowindow:i,picture:{url:r.image_url,width:36,height:36},lat:r.latitude?r.latitude:26+.001*r.id,lng:r.longitude?r.longitude:123+.001*r.id,id:r.id}});o.buildMap({provider:{},internal:{id:"map"}},function(){t=a.map(function(n){var t=o.addMarker(n);return t.serviceObject.id=n.id,google.maps.event.addListener(t.serviceObject,"click",function(){e.location=_.find(e.places,function(e){return e.id==t.serviceObject.id}),e.$apply()}),t}),o.bounds.extendWith(t),o.fitMapToBounds()})})})}]);